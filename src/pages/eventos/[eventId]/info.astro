---
import Layout from '../../Layout.astro';
import Navbar from '../../../shared/components/layouts/Navbar.astro';
import Footer from '../../../shared/components/layouts/Footer.astro';
import EventNavbar from "../../../shared/components/EventNavbar.astro";

// Datos y utilidades
import { getEventBySlug } from "../../../data/events";
import { getCategoriesByEventId } from "../../../data/categories";
import { getCategoryTotalVotes } from '../../../lib/voting';

// Importamos los componentes React separados
import { AwardsInfo } from "../../../components/react/info/AwardsInfo";
import { LeagueInfo } from "../../../components/react/info/LeagueInfo";

// --- VALIDACIÓN Y DATOS ---
const { eventId } = Astro.params;
const currentEvent = getEventBySlug(eventId);

if (!currentEvent) {
  return Astro.redirect('/404');
}

// Lógica condicional
const isLeague = currentEvent.type === 'league';

// Datos específicos para Premios
let voteCount = 0;
let totalCategories = 0;
let totalNominees = 0;

if (!isLeague) {
    const categories = getCategoriesByEventId(currentEvent.id);
    const votesMap = await getCategoryTotalVotes();
    
    voteCount = Object.values(votesMap).reduce((a: any, b: any) => a + b, 0) as number;
    totalCategories = categories.length;
    totalNominees = categories.reduce((acc, cat) => acc + cat.nominees.length, 0);
}
---

<Layout title={`Información - ${currentEvent.title}`}>
  <Navbar />
  <EventNavbar eventSlug={currentEvent.slug} eventName={currentEvent.title} />
  
  <main class="pt-24 text-white overflow-hidden relative bg-[#050505] min-h-screen">
    
    {/* Fondos dinámicos según evento */}
    <div class="absolute inset-0 -z-10 pointer-events-none">
        {isLeague ? (
             <div class="absolute inset-0 bg-gradient-to-br from-green-900/20 via-black to-black"></div>
        ) : (
             <div class="absolute inset-0 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-purple-900/20 via-black to-black"></div>
        )}
    </div>
    
    <div class="container mx-auto px-6 py-16">
      
      {isLeague ? (
        /* VISTA DE LIGA DE FÚTBOL */
        <LeagueInfo 
            client:load 
            event={currentEvent} 
        />
      ) : (
        /* VISTA DE PREMIOS (LAG AWARDS) */
        <AwardsInfo 
            client:load 
            event={currentEvent}
            totalCategories={totalCategories}
            totalNominees={totalNominees}
            voteCount={voteCount}
        />
      )}

    </div>
  </main>
  <Footer />
</Layout>